---
title: Cost Events
description: Track costs by adding cost metadata to your ingested events
---

Cost Insights works by allowing you to add a special `_cost` property to any event you ingest through Polar's Event Ingestion API. These costs are then aggregated and made available through the Metrics API alongside revenue metrics.

## The `_cost` Property

### Basic Structure

To track costs, add a `_cost` property to your event's metadata when ingesting events.

<CodeGroup>
```typescript TypeScript (SDK)
import { Polar } from "@polar-sh/sdk";

const polar = new Polar({
  accessToken: process.env.POLAR_ACCESS_TOKEN,
});

await polar.events.ingest({
  events: [
    {
      name: "llm.inference",
      customerId: "cus_abc123",
      metadata: {
        _cost: {
          amount: 0.025,
          currency: "usd",
        },
      },
    },
  ],
});
```

```python Python (SDK)
from polar_sdk import Polar

polar = Polar(
    access_token=os.environ.get("POLAR_ACCESS_TOKEN")
)

polar.events.ingest(
    events=[
        {
            "name": "llm.inference",
            "customer_id": "cus_abc123",
            "metadata": {
                "_cost": {
                    "amount": 0.025,
                    "currency": "usd"
                }
            }
        }
    ]
)
```

```json cURL
POST https://api.polar.sh/v1/events/ingest
Content-Type: application/json
Authorization: Bearer YOUR_ACCESS_TOKEN

{
  "events": [
    {
      "name": "llm.inference",
      "customer_id": "cus_abc123",
      "metadata": {
        "_cost": {
          "amount": 0.025,
          "currency": "usd"
        }
      }
    }
  ]
}
```
</CodeGroup>

### Cost Metadata Schema

The `_cost` property has the following structure:

- **`amount`** (required): The cost amount in cents as a decimal number

  - Example: `0.025` for $0.00025 (a fraction of a cent)
  - Example: `150` for $1.50
  - Supports up to 17 digits with 12 decimal places for precision

- **`currency`** (required): The currency code
  - Currently only `"usd"` is supported

<Warning>
  **Amount must be in cents**: The `amount` field represents the cost in cents,
  not dollars. For example, `100` = $1.00, `0.5` = $0.005 (half a cent), and
  `0.001` = $0.00001 (one hundredth of a cent).
</Warning>

## Use Cases

### AI/LLM Applications

Track the cost of LLM API calls per customer:

<CodeGroup>
```typescript TypeScript
import { Polar } from "@polar-sh/sdk";
import OpenAI from "openai";

const polar = new Polar({
  accessToken: process.env.POLAR_ACCESS_TOKEN,
});

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// Make LLM API call
const completion = await openai.chat.completions.create({
  model: "gpt-4",
  messages: [{ role: "user", content: "Hello!" }],
});

// Calculate cost (example: $0.03 per 1K input tokens, $0.06 per 1K output tokens)
const inputCost = (completion.usage.prompt_tokens / 1000) * 3; // in cents
const outputCost = (completion.usage.completion_tokens / 1000) * 6; // in cents
const totalCost = inputCost + outputCost;

// Track the cost in Polar
await polar.events.ingest({
  events: [
    {
      name: "gpt4.completion",
      customerId: "cus_abc123",
      metadata: {
        _cost: {
          amount: totalCost,
          currency: "usd",
        },
        _llm: {
          vendor: "openai",
          model: "gpt-4",
          input_tokens: completion.usage.prompt_tokens,
          output_tokens: completion.usage.completion_tokens,
          total_tokens: completion.usage.total_tokens,
        },
      },
    },
  ],
});
```

```python Python
from polar_sdk import Polar
from openai import OpenAI

polar = Polar(
    access_token=os.environ.get("POLAR_ACCESS_TOKEN")
)

openai_client = OpenAI(
    api_key=os.environ.get("OPENAI_API_KEY")
)

# Make LLM API call
completion = openai_client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}]
)

# Calculate cost (example: $0.03 per 1K input tokens, $0.06 per 1K output tokens)
input_cost = (completion.usage.prompt_tokens / 1000) * 3  # in cents
output_cost = (completion.usage.completion_tokens / 1000) * 6  # in cents
total_cost = input_cost + output_cost

# Track the cost in Polar
polar.events.ingest(
    events=[
        {
            "name": "gpt4.completion",
            "customer_id": "cus_abc123",
            "metadata": {
                "_cost": {
                    "amount": total_cost,
                    "currency": "usd"
                },
                "_llm": {
                    "vendor": "openai",
                    "model": "gpt-4",
                    "input_tokens": completion.usage.prompt_tokens,
                    "output_tokens": completion.usage.completion_tokens,
                    "total_tokens": completion.usage.total_tokens
                }
            }
        }
    ]
)
```
</CodeGroup>

### Infrastructure Costs

Track compute, storage, or API costs:

```json
{
  "events": [
    {
      "name": "video.processing",
      "customer_id": "cus_abc123",
      "metadata": {
        "_cost": {
          "amount": 45.5, // $0.455
          "currency": "usd"
        },
        "duration_seconds": 120,
        "resolution": "1080p"
      }
    }
  ]
}
```

### Third-Party Service Costs

Track costs from external services:

```json
{
  "events": [
    {
      "name": "email.sent",
      "customer_id": "cus_abc123",
      "metadata": {
        "_cost": {
          "amount": 0.0001, // $0.000001
          "currency": "usd"
        },
        "provider": "sendgrid",
        "recipients": 1
      }
    }
  ]
}
```

## Best Practices

### Track Costs in Real-Time

Ingest cost events as they occur to maintain accurate, up-to-date metrics:

<CodeGroup>
```typescript TypeScript
import { Polar } from "@polar-sh/sdk";

const polar = new Polar({
  accessToken: process.env.POLAR_ACCESS_TOKEN,
});

// When making an LLM API call
const completion = await openai.chat.completions.create({
  model: "gpt-4",
  messages: [{ role: "user", content: "Hello!" }],
});

const cost = calculateCost(completion.usage); // Cost should be in cents

await polar.events.ingest({
  events: [
    {
      name: "llm.completion",
      customerId: customerId,
      metadata: {
        _cost: {
          amount: cost,
          currency: "usd",
        },
      },
    },
  ],
});
```

```python Python
from polar_sdk import Polar

polar = Polar(
    access_token=os.environ.get("POLAR_ACCESS_TOKEN")
)

# When making an LLM API call
completion = openai_client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}]
)

cost = calculate_cost(completion.usage)  # Cost should be in cents

polar.events.ingest(
    events=[
        {
            "name": "llm.completion",
            "customer_id": customer_id,
            "metadata": {
                "_cost": {
                    "amount": cost,
                    "currency": "usd"
                }
            }
        }
    ]
)
```
</CodeGroup>

### Use Precise Amounts

The `amount` field supports up to 12 decimal places, perfect for tracking micro-costs:

```json
{
  "_cost": {
    "amount": 0.000125, // $0.00000125
    "currency": "usd"
  }
}
```

### Add Context with Additional Metadata

Combine `_cost` with other metadata to understand cost drivers:

```json
{
  "metadata": {
    "_cost": {
      "amount": 0.05, // $0.0005
      "currency": "usd"
    },
    "model": "gpt-4-turbo",
    "tokens": 1000,
    "feature": "chatbot"
  }
}
```
